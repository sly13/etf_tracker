# üîó –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ User ID

## üìã –û–±–∑–æ—Ä

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Telegram –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `userId` –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏ Telegram –∞–∫–∫–∞—É–Ω—Ç—ã –∫ —Å–≤–æ–∏–º –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª—è–º.

## üóÑÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª–µ `userId` –≤ —Ç–∞–±–ª–∏—Ü–µ `User`

```sql
userId String? @unique // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

## üîß API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å User ID

```http
POST /applications/register-device
{
  "token": "fcm_token_here",
  "appName": "etf.flow",
  "userId": "user_12345", // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  "deviceInfo": {
    "deviceType": "android",
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ü–µ—Ç—Ä–æ–≤",
    "email": "ivan@example.com"
  }
}
```

### 2. –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –ø–æ User ID

```http
POST /applications/link-telegram-by-user-id
{
  "userId": "user_12345",
  "telegramChatId": "123456789"
}
```

### 3. –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –ø–æ Device Token (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)

```http
POST /applications/link-telegram
{
  "deviceToken": "fcm_token_here",
  "telegramChatId": "123456789"
}
```

## üì± –ü—Ä–æ—Ü–µ—Å—Å —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
// –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
const response = await fetch('/applications/register-device', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    token: fcmToken,
    appName: 'etf.flow',
    userId: currentUser.id, // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    deviceInfo: {
      deviceType: 'android',
      firstName: currentUser.firstName,
      lastName: currentUser.lastName,
      email: currentUser.email,
    },
  }),
});
```

### –®–∞–≥ 2: –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram"

```javascript
// –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
async function subscribeToTelegram() {
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram –±–æ—Ç–∞
  const botUrl = 'https://t.me/your_bot_username';
  window.open(botUrl, '_blank');

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  showInstructions();
}

function showInstructions() {
  alert(`
    –î–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
    
    1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –±–æ—Ç—É
    2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Chat ID –∏–∑ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
    3. –í–≤–µ–¥–∏—Ç–µ Chat ID –≤ –ø–æ–ª–µ –Ω–∏–∂–µ
  `);
}
```

### –®–∞–≥ 3: –í–≤–æ–¥ Chat ID

```javascript
// –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
async function linkTelegramAccount(chatId) {
  const response = await fetch('/applications/link-telegram-by-user-id', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      userId: currentUser.id,
      telegramChatId: chatId,
    }),
  });

  const result = await response.json();
  if (result.success) {
    alert('‚úÖ Telegram –∞–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!');
  } else {
    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
  }
}
```

## ü§ñ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Telegram Bot

### –ö–æ–º–∞–Ω–¥–∞ /start

```
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ETF Flow Tracker!

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–∞–º –Ω—É–∂–Ω–æ:
1. üì± –û—Ç–∫—Ä—ã—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. üîó –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. üìù –í–≤–µ—Å—Ç–∏ —ç—Ç–æ—Ç Chat ID: `123456789`
4. ‚úÖ –ù–∞–∂–∞—Ç—å "–ü—Ä–∏–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:
‚Ä¢ üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö ETF –ø–æ—Ç–æ–∫–æ–≤
‚Ä¢ üìà –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –ø–æ—Ç–æ–∫–æ–≤
```

### –ö–æ–º–∞–Ω–¥–∞ /status

```
üìä –°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞:

‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –í–∫–ª—é—á–µ–Ω—ã
üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ETF Flow Tracker
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
üÜî User ID: user_12345
üìÖ –ü—Ä–∏–≤—è–∑–∞–Ω: 06.09.2024 19:23

üîî –ê–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
‚Ä¢ ETF –ø–æ—Ç–æ–∫–∏
‚Ä¢ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `userId` –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `User` —Å `userId`

### 2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Telegram

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram"
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Telegram –±–æ—Ç–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` –±–æ—Ç—É
- –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Chat ID
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç Chat ID –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç API –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- –°–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `enableTelegramNotifications: true`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å User ID

```bash
curl -X POST http://localhost:3000/applications/register-device \
  -H "Content-Type: application/json" \
  -d '{
    "token": "test_token_123",
    "appName": "etf.flow",
    "userId": "user_12345",
    "deviceInfo": {
      "deviceType": "android",
      "firstName": "–¢–µ—Å—Ç",
      "lastName": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
    }
  }'
```

### –¢–µ—Å—Ç –ø—Ä–∏–≤—è–∑–∫–∏ Telegram

```bash
curl -X POST http://localhost:3000/applications/link-telegram-by-user-id \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user_12345",
    "telegramChatId": "123456789"
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl http://localhost:3000/applications/user/test_token_123
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–£–¥–æ–±—Å—Ç–≤–æ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–≤—è–∑–∞—Ç—å Telegram —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: `userId` —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ —Å—Ç–∞—Ä–æ–≥–æ (deviceToken), —Ç–∞–∫ –∏ –Ω–æ–≤–æ–≥–æ (userId) —Å–ø–æ—Å–æ–±–∞
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- `userId` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- Telegram Chat ID —É–Ω–∏–∫–∞–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–≤—è–∑—ã–≤–∞–Ω–∏—è

## üéØ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `userId`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ª–µ–≥–∫–æ —Å–≤—è–∑—ã–≤–∞—Ç—å —Å–≤–æ–∏ Telegram –∞–∫–∫–∞—É–Ω—Ç—ã —Å –º–æ–±–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
